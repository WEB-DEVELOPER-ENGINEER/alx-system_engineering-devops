#!/usr/bin/env bash

# Get the process ID of the Gunicorn master
MASTER_PID=$(pgrep -f 'gunicorn.*web_flask.0-hello_route:app')

# Check if the Gunicorn master process is running
if [ -z "$MASTER_PID" ]; then
  exit 1
fi

# Send a HUP signal to the master to gracefully reload workers
kill -HUP $MASTER_PID

# Wait for the master to complete the reload
sleep 2

# Check if the master process is still running
if ! ps -p $MASTER_PID > /dev/null; then
  exit 0
else
  exit 1
fi
